spring.application.name=backend

# MySQL 数据库连接
spring.datasource.url=jdbc:mysql://localhost:3306/pandora_repo?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ===== HikariCP 数据库连接池配置 =====
# 最大连接数（默认 10）
# SSE 长连接和普通请求都需要数据库连接，需要增加连接池大小
spring.datasource.hikari.maximum-pool-size=50
# 最小空闲连接数（默认与 maximum-pool-size 相同）
spring.datasource.hikari.minimum-idle=10
# 连接超时时间（毫秒，默认 30000）
spring.datasource.hikari.connection-timeout=30000
# 空闲连接最大存活时间（毫秒，默认 600000 = 10分钟）
spring.datasource.hikari.idle-timeout=600000
# 连接最大存活时间（毫秒，默认 1800000 = 30分钟）
spring.datasource.hikari.max-lifetime=1800000

# Flyway 配置（可选，默认自动扫描 db/migration）
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration,classpath:db/testdata
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=false

# 后端url
server.port = 8080
server.address = 0.0.0.0

# ===== Tomcat 线程池配置 =====
# SSE 长连接会占用线程，需要增加线程池大小
server.tomcat.threads.max=150
# 最小空闲线程数（默认 10）
server.tomcat.threads.min-spare=20
# 最大连接数（默认 8192）
server.tomcat.max-connections=10000
# 等待队列长度（默认 100）
server.tomcat.accept-count=100
# 连接超时时间（毫秒）
server.tomcat.connection-timeout=20000

management.endpoints.web.exposure.include=health,info

# ===== Redis 配置 =====
# Redis 服务器地址
spring.data.redis.host=localhost
# Redis 端口
spring.data.redis.port=6379
# Redis 密码（本地无密码可不配置）
# spring.data.redis.password=
# Redis 数据库索引（0-15）
spring.data.redis.database=0
# 连接超时时间（毫秒）
spring.data.redis.timeout=3000

# Redis 连接池配置 (Lettuce)
spring.data.redis.lettuce.pool.max-active=15
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms

# Redisson 配置（分布式锁）
# Redisson 会自动查找 classpath:redisson-config.yml
# 如果需要指定路径，使用: spring.redisson.config=classpath:redisson-config.yml

# ===== Token 清理配置 =====
# 启动时是否清理过期 Token（0=不清理，1=清理）
cleanup.on.start=0

# ===== GLM-4.6 API 配置 =====
# GLM API Key (请替换为你的实际 API Key)
glm.apiKey=997368444eb84f49950415255ef5a707.DgPiN0uDzSRgusFG
# GLM API URL
glm.apiUrl=https://open.bigmodel.cn/api/paas/v4
# 默认模型
glm.model=glm-4
# 请求超时时间（秒）
glm.timeout=60

# ===== 文件上传配置 =====
# 我们的文件上传存储目录
# 修改为项目内的uploads目录
file.upload-dir=./uploads

# 增加文件上传大小限制
# 默认 Spring 限制为 1MB，这太小了
spring.servlet.multipart.max-file-size=20MB
spring.servlet.multipart.max-request-size=100MB

# ===== 日志配置 =====
# 降低 Spring Security 异步请求的错误日志级别
# SSE 连接关闭时可能触发 "response already committed" 错误，这是正常现象
logging.level.org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/].[dispatcherServlet]=WARN
logging.level.org.springframework.security.web.access.ExceptionTranslationFilter=WARN
