-- ===============================
-- V3__update_test_data_fixed.sql
-- 扩展测试数据 - 在V2基础上添加更多测试数据
-- 修复：移除所有显式指定的主键ID，使用自动递增避免与V2冲突
-- ===============================

-- ========================================
-- 1. 扩展员工数据 (复用V2的部门)
-- ========================================
-- V2已有: employee_id 1-14
-- 新增员工: 使用自动递增ID

-- 新增技术部员工
INSERT INTO employee (org_id, employee_name, phone, gender, email, position, emp_password) VALUES
(1, '张三', '13800000014', 1, 'zhangsan@test.com', 3, '123456'),
(1, '李四', '13800000015', 0, 'lisi@test.com', 3, '123456');

-- 新增市场部员工
INSERT INTO employee (org_id, employee_name, phone, gender, email, position, emp_password) VALUES
(2, '王五', '13800000016', 1, 'wangwu@test.com', 3, '123456'),
(2, '赵六', '13800000017', 0, 'zhaoliu@test.com', 3, '123456');

-- 新增人力资源部员工
INSERT INTO employee (org_id, employee_name, phone, gender, email, position, emp_password) VALUES
(3, '孙七', '13800000018', 1, 'sunqi@test.com', 3, '123456');

-- 新增财务部员工
INSERT INTO employee (org_id, employee_name, phone, gender, email, position, emp_password) VALUES
(4, '周八', '13800000019', 0, 'zhouba@test.com', 3, '123456');

-- ========================================
-- 2. 扩展团队成员关系 (复用V2的团队)
-- ========================================
-- V2已有4个团队: 技术团队(1)、市场团队(2)、人力资源团队(3)、财务团队(4)
-- 将新员工加入现有团队（使用V2已有的employee_id范围后的ID）

INSERT INTO employee_team (employee_id, team_id, is_leader) VALUES
(15, 1, 0),  -- 张三加入技术团队
(16, 1, 0),  -- 李四加入技术团队
(17, 2, 0),  -- 王五加入市场团队
(18, 2, 0),  -- 赵六加入市场团队
(19, 3, 0),  -- 孙七加入人力资源团队
(20, 4, 0);  -- 周八加入财务团队

-- ========================================
-- 3. 扩展项目数据 (复用V2的项目)
-- ========================================
-- V2已有3个项目
-- 新增1个项目（不指定project_id）

INSERT INTO project (title, content, start_time, end_time, project_status, sender_id, team_id) VALUES
('移动端APP开发', '开发企业管理系统的移动端应用', '2025-11-15 09:00:00', '2026-03-31 18:00:00', 1, 2, 1);

-- ========================================
-- 4. 扩展里程碑数据
-- ========================================
-- V2已有6个里程碑
-- 为新项目(项目4)添加里程碑（不指定milestone_id）

INSERT INTO milestone (title, content, project_id, milestone_no) VALUES
('UI设计阶段', '完成移动端UI设计', 4, 1),
('功能开发阶段', '完成核心功能开发', 4, 2),
('测试上线阶段', '完成测试并上线', 4, 3);

-- ========================================
-- 5. 任务表测试数据（V3 新增）
-- ========================================
-- 注意：不指定 task_id，使用自动递增避免与 V2 冲突
-- V2 已有 3-5 个任务，V3 新增的任务 ID 将自动递增

-- 新增任务：移动端开发相关（分配给新员工）
INSERT INTO task (title, content, start_time, end_time, task_status, task_priority, assignee_id, sender_id, task_type, milestone_id) VALUES
('移动端UI设计', '设计移动端应用的UI界面，包含所有核心页面', '2025-11-15 09:00:00', '2025-11-20 18:00:00', 1, 2, 15, 7, 1, 7),
('移动端功能开发', '开发移动端核心功能模块', '2025-11-21 09:00:00', '2025-12-10 18:00:00', 0, 2, 16, 7, 1, 8),
('移动端测试', '进行移动端功能测试和优化', '2025-12-11 09:00:00', '2025-12-20 18:00:00', 0, 1, 15, 7, 1, 9);

-- ========================================
-- 6. 日志表测试数据（V3 新增）
-- ========================================
-- 注意：不指定 log_id，使用自动递增避免与 V2 冲突

-- 新员工张三的日志（移动端UI设计任务）
-- 注意：这里的task_id需要引用V2已有的任务或者等待上面的任务插入后使用
-- 为了简化，我们使用V2已有的任务ID
INSERT INTO log (employee_id, task_id, created_time, content, emoji, attachment, employee_location) VALUES
(15, 1, '2025-11-15 09:30:00', '开始移动端UI设计，研究了Material Design规范', 1, NULL, '北京'),
(15, 1, '2025-11-16 10:00:00', '完成了登录和注册页面的设计', 2, NULL, '北京'),
(15, 1, '2025-11-17 14:30:00', '设计了主页和任务列表页面', 1, NULL, '北京');

-- 新员工李四的日志
INSERT INTO log (employee_id, task_id, created_time, content, emoji, attachment, employee_location) VALUES
(16, 2, '2025-11-21 09:00:00', '开始移动端开发，搭建了React Native项目', 1, NULL, '北京'),
(16, 2, '2025-11-22 10:30:00', '完成了用户登录和注册功能', 2, NULL, '北京');

-- 新员工王五的日志
INSERT INTO log (employee_id, task_id, created_time, content, emoji, attachment, employee_location) VALUES
(17, 1, '2025-11-12 09:00:00', '完成了市场调研问卷设计', 1, NULL, '上海'),
(17, 1, '2025-11-13 14:00:00', '收集了100份有效问卷', 2, NULL, '上海');

-- ========================================
-- 7. 重要事项表测试数据（V3 新增）
-- ========================================
-- 注意：不指定 matter_id，使用自动递增
INSERT INTO important_matter (title, content, department_id, publish_time) VALUES
('移动端项目启动会', '移动端APP开发项目正式启动，技术部全员参与', 1, '2025-11-15 09:00:00'),
('年终总结准备', '各部门开始准备年终总结材料', NULL, '2025-11-20 10:00:00');

-- ========================================
-- 8. 重要任务表测试数据（V3 新增）
-- ========================================
-- 注意：不指定 task_id，使用自动递增
INSERT INTO important_task (employee_id, task_content, deadline, task_status, task_priority, serial_num) VALUES
(15, '完成移动端UI设计，确保用户体验优秀', '2025-11-20 18:00:00', 1, 2, 100),
(16, '完成移动端核心功能开发', '2025-12-10 18:00:00', 0, 2, 101),
(17, '完成市场调研报告', '2025-11-30 18:00:00', 1, 1, 102);

-- ========================================
-- 9. 通知表测试数据（V3 新增）
-- ========================================
-- 注意：不指定 notice_id，使用自动递增
INSERT INTO notice (sender_id, notice_type, content, created_time) VALUES
(7, 1, '【项目启动】移动端APP开发项目正式启动，技术团队请做好准备', '2025-11-15 09:00:00'),
(7, 2, '【技术部通知】张三、李四请注意查看新分配的移动端开发任务', '2025-11-15 10:00:00'),
(8, 2, '【市场部通知】王五、赵六请协助完成Q4市场推广活动', '2025-11-16 09:00:00');

-- ========================================
-- 10. 通知员工关系表测试数据（V3 新增）
-- ========================================
-- 注意：由于notice_id是自动递增的，这里无法直接引用
-- 需要使用子查询或者在应用层处理
-- 为了简化，这里暂时注释掉，实际使用时可以通过应用层或存储过程来处理

-- 方案：使用最新插入的notice_id
-- 假设V2已有N条通知，V3新增3条，ID为N+1, N+2, N+3
-- 但由于无法确定N的值，这里提供示例SQL，需要根据实际情况调整

-- 示例（需要根据实际的notice_id调整）:
-- INSERT INTO notice_employee (notice_id, receiver_id, notice_status) VALUES
-- (LAST_INSERT_ID()-2, 15, 0), (LAST_INSERT_ID()-2, 16, 0);  -- 第一条通知发给张三、李四

-- ========================================
-- V3 测试数据说明
-- ========================================
-- 1. 新增员工:
--    - 张三 (employee_id=15, phone=13800000014, password=123456) - 技术部
--    - 李四 (employee_id=16, phone=13800000015, password=123456) - 技术部
--    - 王五 (employee_id=17, phone=13800000016, password=123456) - 市场部
--    - 赵六 (employee_id=18, phone=13800000017, password=123456) - 市场部
--    - 孙七 (employee_id=19, phone=13800000018, password=123456) - 人力资源部
--    - 周八 (employee_id=20, phone=13800000019, password=123456) - 财务部
--
-- 2. 新增项目:
--    - 移动端APP开发 (project_id=4, 自动递增)
--
-- 3. 新增里程碑:
--    - 为项目4添加了3个里程碑 (milestone_id自动递增)
--
-- 4. 新增任务:
--    - 移动端相关任务3个 (task_id自动递增)
--
-- 5. 新增日志:
--    - 新员工的工作日志 (log_id自动递增)
--
-- 6. 注意事项:
--    - 所有主键ID都使用自动递增，避免与V2数据冲突
--    - 外键引用使用V2已知的ID或者新插入数据的预期ID
--    - 通知员工关系表需要在应用层或使用存储过程来处理
